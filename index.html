<!doctype html>
<html>
<head>
	<title>
		Game of Life!
	</title>
	<style>
		table{
			border-collapse: collapse;
		}
		td{
			height: 10px;
			width: 10px;
			border: 1px #777777 solid;
		}
		
		.alive{
			background-color: #00FF00;
		}
		.dead{
			background-color: #000000;
		}
	</style>
</head>
<body>
	<table id="world">
		<tbody id="worldTbody"></tbody>
	</table>
</body>
</html>

<script type="text/javascript">
	
	function Cell(){
		var currentState = false;
		var nextState = false;
		var htmlElement;
		
		var neighbors = []; // 0: North, 1: East, 2: South, 3: West
		
		function calculateNext(){
		
		}
		
		function getState(){
			return currentState;
		}
		
		function flip(){
			currentState = !currentState;
		}
		
		function setHtmlElement(nElement){
			htmlElement = nElement;
		}
		
		function setNeighbors(nNeighbors){
			neighbors = nNeighbors;
		}
		
		function render(){
			if(currentState){
				htmlElement.className = 'alive';
			} else {
				htmlElement.className = 'dead';
			}
			console.log(htmlElement.id);
			console.log(htmlElement);
		}
		
		return {
			 calculateNext: 	calculateNext
			,getState:			getState
			,flip:				flip
			,setNeighbors:		setNeighbors
			,setHtmlElement: 	setHtmlElement
			,render:			render
		};
	}
	
	function World(params){
		var grid = [];
		populateGrid();
		
		function populateGrid(){
			for(var y = 0; y < params.height; y++){
				grid[y] = [];
				
				for(var x = 0; x < params.width; x++){
					grid[y][x] = new Cell();
				}
			}
			setNeighbors();
		}
		
		function setNeighbors(){
			for(var y = 0; y < params.height; y++){
				for(var x = 0; x < params.width; x++){
					grid[y][x].setNeighbors([
						 getGridCell(y-1, x)
						,getGridCell(y, x-1)
						,getGridCell(y+1, x)
						,getGridCell(y, x-1)
					]);
				}
			}
			createHtmlTable();
		}
		
		function createHtmlTable(){
			for(var y = 0; y < params.height; y++){
				params.renderTbody.innerHTML += '<tr id="row'+y+'"></tr>';
				var row = document.getElementById('row'+y);
				for(var x = 0; x < params.width; x++){
					row.innerHTML += '<td id="'+y+'-'+x+'"></td>';
					var cell = document.getElementById(y+'-'+x);
					grid[y][x].setHtmlElement(cell);
				}
			}
			render();
		}
		
		function render(){
			for(var y = 0; y < params.height; y++){
				for(var x = 0; x < params.width; x++){
					grid[y][x].render();
				}
			}
		}
		
		function getGridCell(posY, posX){
			var row = [];
			
			if(posY < 0){
				if(params.wrapEdges){
					row = grid[grid.length + posY];
				} else {
					return null;
				}
			} else if(posY >= grid.length){
				if(params.wrapEdges){
					row = grid[posY - grid.length];
				} else {
					return null;
				}
			} else {
				row = grid[posY];
			}
			
			if(posX < 0){
				if(params.wrapEdges){
					return row[row.length + posX];
				} else {
					return null;
				}
			} else if(posX >= row.length){
				if(params.wrapEdges){
					return grid[posX - row.length];
				} else {
					return null;
				}
			} else {
				return row[posY];
			}
			
			return null;
		}
	}
	
	var world = new World({
		 height: 20
		,width: 20
		,wrapEdges: false
		,renderTbody: document.getElementById('worldTbody')
	});
	
</script>